<cdk-tree
  class="tree"
  *ngIf="dataSource"
  [dataSource]="dataSource"
  [treeControl]="treeControl"
  cdkDropListGroup>
  <cdk-nested-tree-node *cdkTreeNodeDef="let node" class="tree-node">
    <div class="tree-node-container">
      <!-- <div
        cdkDropList
        [cdkDropListData]="node"
        class="tree-node-container-drop-zone"
        [class.hide]="!dragging"
        [cdkDropListEnterPredicate]="internalAllowDrop"></div> -->
      <div
        cdkDropList
        [cdkDropListData]="node"
        [cdkDropListEnterPredicate]="internalAllowDrop()">
        <div
          cdkDrag
          [cdkDragData]="node"
          (cdkDragStarted)="dragging = true"
          (cdkDragReleased)="dragging = false"
          (cdkDragDropped)="handleDrop($event)">
          <ngcx-tree-node
            [nodeWrapper]="node"
            [treeControl]="treeControl"
            [treeNodeContentComponent]="
              treeNodeContentComponent
            "></ngcx-tree-node>
        </div>
      </div>
    </div>
  </cdk-nested-tree-node>

  <cdk-nested-tree-node
    *cdkTreeNodeDef="let node; when: hasChild"
    class="tree-node">
    <div class="tree-node-container" [class.dragging]="dragging">
      <!-- <div
        cdkDropList
        [cdkDropListData]="node"
        class="tree-node-container-drop-zone"
        [class.hide]="!dragging"
        [cdkDropListEnterPredicate]="allowDropInto"></div> -->
      <div
        cdkDropList
        [cdkDropListData]="node"
        [cdkDropListEnterPredicate]="internalAllowDrop()">
        <div
          cdkDrag
          [cdkDragDisabled]="true"
          [cdkDragData]="node"
          (cdkDragStarted)="dragging = true"
          (cdkDragReleased)="dragging = false"
          (cdkDragDropped)="handleDrop($event)">
          <div
            class="tree-node-content-container"
            [class.first]="node.isFirstChild"
            [class.last]="node.isLastChild"
            [class.expanded]="treeControl.isExpanded(node)">
            <ngcx-tree-node
              [nodeWrapper]="node"
              [treeControl]="treeControl"
              [treeNodeContentComponent]="
                treeNodeContentComponent
              "></ngcx-tree-node>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="treeControl.isExpanded(node)"
      class="tree-node-children-container"
      [class.first]="node.isFirstChild"
      [class.last]="node.isLastChild">
      <div cdkTreeNodeOutlet></div>
    </div>
  </cdk-nested-tree-node>
</cdk-tree>
